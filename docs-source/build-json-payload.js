const yaml = require('yaml')
const fs = require('fs')
const path = require('path')

const imageFiles = fs.readdirSync('./docs-source').filter(f => f.match(/.*\.yml/))
const json = imageFiles.map(filename => {
  const raw = fs.readFileSync(`./docs-source/${filename}`, 'utf8')
  const parsed = yaml.parse(raw)
  return Object.assign(parsed, {
    id: filename.replace(/\d{3}-/, '').replace(path.extname(filename), ''),
    description: parsed.description.replace(/\n$/, '')
  })
}).reverse() // reverse to maintain the right order of files

const document = {
  warnings: [
    "DO NOT EDIT THIS FILE MANUALLY, IT IS AUTO-GENERATED WITH build-json-payload.js"
  ],
  notes: [
    "add c_scale,w_500/ param to 'imageSrcSmall' URLs after /upload/ param",
  ],
  images: json
}

// fs.writeFileSync('./docs/images.json', JSON.stringify(document))
fs.writeFileSync('./docs/images.json', JSON.stringify(document, null, 2))

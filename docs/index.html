<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <title>Generative Art by Eric</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link rel="stylesheet" href="styles.css" />
</head>

<body>
  <!-- Put all the junk here 🗑️ -->
  <div class="vert-container">

    <!-- Thanks to https://github.com/edent/SuperTinyIcons/blob/fef4b0e576726f4f78c5707327281e689b5b5801/images/svg/github.svg for the icon -->
    <h1 class="source">Generative art
      <a href="https://github.com/ericyd/generative-art">
      <svg xmlns="http://www.w3.org/2000/svg"
      class="github-logo"
        aria-label="GitHub" role="img"
        viewBox="0 0 512 512"><rect
        width="512" height="512"
        rx="15%"
        fill="#1B1817"/>
        <path fill="#fff" d="M335 499c14 0 12 17 12 17H165s-2-17 12-17c13 0 16-6 16-12l-1-50c-71 16-86-28-86-28-12-30-28-37-28-37-24-16 1-16 1-16 26 2 40 26 40 26 22 39 59 28 74 22 2-17 9-28 16-35-57-6-116-28-116-126 0-28 10-51 26-69-3-6-11-32 3-67 0 0 21-7 70 26 42-12 86-12 128 0 49-33 70-26 70-26 14 35 6 61 3 67 16 18 26 41 26 69 0 98-60 120-117 126 10 8 18 24 18 48l-1 70c0 6 3 12 16 12z"/>
      </svg>
    </a></h1>
    <h2 class="source">by eric</h2>
    <h3 class="source">made with <a href="https://openrndr.org/" target="_blank">OPENRNDR</a></h3>

    <div class="cards" id="cards">
      <!-- Cards are populated dynamically from data in images.json -->
    </div>

    <div class="pagination" id="pagination">
      <!-- Pagination is populated dynamically from data in images.json -->
    </div>

    <div class="vert-spacer"></div>
    <footer>
      Thanks to <a href="https://cloudinary.com/">Cloudinary</a> for the free image hosting tier, and <a href="https://github.com/edent/SuperTinyIcons/blob/fef4b0e576726f4f78c5707327281e689b5b5801/images/svg/github.svg">SuperTinyIcons</a> for the GitHub logo!
      <br>
      Thanks to the generative art community for unending inspiration.
    </footer>
  </div>

  <script type="text/javascript">

    /**
     * type ImageSource = {
     *   src: string,
     *   srcSmall: string,
     * }
     *
     * type Image = {
     *   title: string,
     *   imageSeries: ImageSource[],
     *   description: string,
     *   sourceCodeLink: string,
     *   comments: string?,
     *   createdAt: string,
     * }
     */

    /* lol... this is what suckers did before React came along */
    function buildCard(image, description) {
      const card = document.createElement("div")
      card.classList.add('card')
      card.appendChild(image)
      card.appendChild(description)
      return card
    }

    /**
     * @param {ImageSource} imgSource source details for the current ImageSource
     * @param {number} index the current index of the imgSource
     * @param {Image} image the parent image
     */
    function buildImageTag(imgSource, index, image) {
      const a = document.createElement("a")
      a.setAttribute("href", imgSource.src)
      a.setAttribute("target", "_blank")

      const img = document.createElement("img")
      img.setAttribute("src", imgSource.srcSmall)
      img.setAttribute("alt", `${image.title} ${index}`)

      a.appendChild(img)
      return a
    }

    /**
     * @param {Image} image
     */
    function buildImageContainer(image) {
      const container = document.createElement("div")
      container.classList.add("image-container")
      const imageLinks = image.imageSeries.map((imgSource, index) => buildImageTag(imgSource, index, image))

      // Add the first image source as the default
      container.appendChild(imageLinks[0])

      // If there are multiple image sources, we need to add buttons to cycle through them
      console.log(imageLinks.length)
      if (imageLinks.length > 1) {
        let currentIndex = 0

        const leftButton = document.createElement("button")
        leftButton.classList.add("pagination-btn")
        leftButton.classList.add("source")
        leftButton.appendChild(document.createTextNode("<"))
        const rightButton = document.createElement("button")
        rightButton.classList.add("pagination-btn")
        rightButton.classList.add("source")
        rightButton.appendChild(document.createTextNode(">"))

        leftButton.addEventListener('click', e => {
          currentIndex = currentIndex === 0 ? imageLinks.length - 1 : currentIndex - 1
          container.removeChild(container.children[0])
          container.insertBefore(imageLinks[currentIndex], leftButton)
        })

        rightButton.addEventListener('click', e => {
          currentIndex = currentIndex === imageLinks.length - 1 ? 0 : currentIndex + 1
          container.removeChild(container.children[0])
          container.insertBefore(imageLinks[currentIndex], leftButton)
        })

        container.appendChild(leftButton)
        container.appendChild(rightButton)
      }

      return container
    }

    function buildSourceCodeLink(sourceCodeLink) {
      const a = document.createElement("a")
      a.classList.add("source")
      a.setAttribute("href", sourceCodeLink)
      a.setAttribute("target", "_blank")
      a.appendChild(document.createTextNode("source code ⬈"))
      return a
    }

    function buildDescription(content, sourceCodeLink) {
      const description = document.createElement("div")
      description.classList.add('description')
      /* I mean... pretty unsafe, but hey, sometimes you gotta live on the edge 😎 */
      description.innerHTML = content
      description.appendChild(
        document.createElement("br")
      )
      description.appendChild(
        buildSourceCodeLink(sourceCodeLink)
      )
      return description
    }

    function populateImage(cardsContainer) {
      return (image) => {
        // console.log(image)
        const description = buildDescription(image.description, image.sourceCodeLink)
        const imageContainer = buildImageContainer(image)
        const card = buildCard(imageContainer, description)
        cardsContainer.appendChild(card)
      }
    }

    function populateImages(images) {
      const cardsContainer = document.getElementById("cards")
      images.forEach(populateImage(cardsContainer))
    }

    function clearImages() {
      const cards = document.getElementById("cards")
      while (cards.children.length > 0) {
        cards.removeChild(cards.children[0])
      }
    }

    /**
     * Generates pagination links and binds events to each.
     * @returns {Array<Image>} images for first page
     */
    function paginate(images, size = 10) {
      // returns an array of arrays, with each inner array representing a "page" of images with max length `size`
      const pages = images.reduce((accumulator, currentValue) => {
        if (accumulator.length === 0 || accumulator[accumulator.length - 1].length === size) {
          accumulator.push([])
        }
        accumulator[accumulator.length - 1].push(currentValue)
        return accumulator
      }, [])


      // Only add pagination buttons if there is more than 1 page
      if (pages.length > 1) {
        pages.forEach((page, index) => {
          const pageBtn = document.createElement("button")
          pageBtn.classList.add("pagination-btn")
          pageBtn.classList.add("source")
          pageBtn.addEventListener('click', e => {
            clearImages()
            populateImages(page)
          })
          pageBtn.appendChild(document.createTextNode(index.toString()))
          document.getElementById("pagination").appendChild(pageBtn)
        })
      }

      return pages[0]
    }

    function fetchImages(_event) {
      fetch('/generative-art/images.json')
        .then(response => response.json())
        .then(data => {
          const images = paginate(data.images)
          populateImages(images)
        })
        .catch(console.error.bind(console));
    }

    window.addEventListener('load', fetchImages)
  </script>
</body>

</html>
